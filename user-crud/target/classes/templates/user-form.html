<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title th:text="${isEdit ? 'Edit User' : 'Add New User'} + ' - User CRUD Application'">User Form</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header fade-in">
            <h1>
                <i class="fas" th:classappend="${isEdit ? 'fa-edit' : 'fa-user-plus'}"></i>
                <span th:text="${isEdit ? 'Edit User' : 'Add New User'}">User Form</span>
            </h1>
            <p th:text="${isEdit ? 'Update user information' : 'Create a new user account'}">User Form</p>
        </div>

        <!-- User Form -->
        <div class="card slide-in">
            <form th:action="${isEdit ? '/users/' + user.id : '/users'}" 
                  th:object="${user}" method="post" class="user-form">
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="firstName" class="form-label">
                            <i class="fas fa-user"></i> First Name *
                        </label>
                        <input type="text" id="firstName" th:field="*{firstName}" 
                               class="form-control" placeholder="Enter first name" 
                               th:required="true" maxlength="100">
                        <div th:if="${#fields.hasErrors('firstName')}" class="alert alert-danger" style="margin-top: 5px;">
                            <span th:errors="*{firstName}"></span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="lastName" class="form-label">
                            <i class="fas fa-user"></i> Last Name *
                        </label>
                        <input type="text" id="lastName" th:field="*{lastName}" 
                               class="form-control" placeholder="Enter last name" 
                               th:required="true" maxlength="100">
                        <div th:if="${#fields.hasErrors('lastName')}" class="alert alert-danger" style="margin-top: 5px;">
                            <span th:errors="*{lastName}"></span>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="email" class="form-label">
                        <i class="fas fa-envelope"></i> Email Address *
                    </label>
                    <input type="email" id="email" th:field="*{email}" 
                           class="form-control" placeholder="Enter email address" 
                           th:required="true" maxlength="150">
                    <div th:if="${#fields.hasErrors('email')}" class="alert alert-danger" style="margin-top: 5px;">
                        <span th:errors="*{email}"></span>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="phone" class="form-label">
                            <i class="fas fa-phone"></i> Phone Number
                        </label>
                        <input type="tel" id="phone" th:field="*{phone}" 
                               class="form-control" placeholder="Enter phone number" 
                               maxlength="20">
                        <div th:if="${#fields.hasErrors('phone')}" class="alert alert-danger" style="margin-top: 5px;">
                            <span th:errors="*{phone}"></span>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="address" class="form-label">
                            <i class="fas fa-map-marker-alt"></i> Address
                        </label>
                        <input type="text" id="address" th:field="*{address}" 
                               class="form-control" placeholder="Enter address" 
                               maxlength="200">
                        <div th:if="${#fields.hasErrors('address')}" class="alert alert-danger" style="margin-top: 5px;">
                            <span th:errors="*{address}"></span>
                        </div>
                    </div>
                </div>

                <!-- Hidden fields for edit mode -->
                <input type="hidden" th:field="*{id}" th:if="${isEdit}">
                <input type="hidden" th:field="*{createdAt}" th:if="${isEdit}">
                <input type="hidden" th:field="*{updatedAt}" th:if="${isEdit}">

                <!-- Form Actions -->
                <div style="text-align: center; margin-top: 30px;">
                    <button type="submit" class="btn" 
                            th:classappend="${isEdit ? 'btn-warning' : 'btn-success'}">
                        <i class="fas" th:classappend="${isEdit ? 'fa-save' : 'fa-plus'}"></i>
                        <span th:text="${isEdit ? 'Update User' : 'Create User'}">Submit</span>
                    </button>
                    
                    <a th:href="@{/}" class="btn btn-info" style="margin-left: 15px;">
                        <i class="fas fa-arrow-left"></i> Back to List
                    </a>
                    
                    <button type="reset" class="btn btn-danger" style="margin-left: 15px;">
                        <i class="fas fa-undo"></i> Reset
                    </button>
                </div>
            </form>
        </div>

        <!-- Form Tips -->
        <div class="card">
            <h3 style="color: var(--primary-color); margin-bottom: 15px;">
                <i class="fas fa-lightbulb"></i> Form Tips
            </h3>
            <ul style="list-style: none; padding: 0;">
                <li style="margin-bottom: 10px; padding-left: 20px; position: relative;">
                    <i class="fas fa-check" style="color: var(--success-color); position: absolute; left: 0;"></i>
                    Fields marked with * are required
                </li>
                <li style="margin-bottom: 10px; padding-left: 20px; position: relative;">
                    <i class="fas fa-check" style="color: var(--success-color); position: absolute; left: 0;"></i>
                    Email must be unique across all users
                </li>
                <li style="margin-bottom: 10px; padding-left: 20px; position: relative;">
                    <i class="fas fa-check" style="color: var(--success-color); position: absolute; left: 0;"></i>
                    Phone number and address are optional
                </li>
                <li style="margin-bottom: 10px; padding-left: 20px; position: relative;">
                    <i class="fas fa-check" style="color: var(--success-color); position: absolute; left: 0;"></i>
                    All data is automatically validated
                </li>
            </ul>
        </div>
    </div>

    <script>
        // Form validation
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.querySelector('.user-form');
            const emailInput = document.getElementById('email');
            const firstNameInput = document.getElementById('firstName');
            const lastNameInput = document.getElementById('lastName');

            // Real-time validation
            function validateEmail(email) {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                return emailRegex.test(email);
            }

            function validateName(name) {
                return name.trim().length >= 2;
            }

            // Email validation
            emailInput.addEventListener('blur', function() {
                const email = this.value.trim();
                if (email && !validateEmail(email)) {
                    this.style.borderColor = 'var(--danger-color)';
                    this.style.boxShadow = '0 0 0 3px rgba(245, 101, 101, 0.1)';
                } else {
                    this.style.borderColor = 'var(--border-color)';
                    this.style.boxShadow = 'none';
                }
            });

            // Name validation
            [firstNameInput, lastNameInput].forEach(input => {
                input.addEventListener('blur', function() {
                    const name = this.value.trim();
                    if (name && !validateName(name)) {
                        this.style.borderColor = 'var(--danger-color)';
                        this.style.boxShadow = '0 0 0 3px rgba(245, 101, 101, 0.1)';
                    } else {
                        this.style.borderColor = 'var(--border-color)';
                        this.style.boxShadow = 'none';
                    }
                });
            });

            // Form submission
            form.addEventListener('submit', function(e) {
                const email = emailInput.value.trim();
                const firstName = firstNameInput.value.trim();
                const lastName = lastNameInput.value.trim();

                let isValid = true;

                // Validate required fields
                if (!firstName || !validateName(firstName)) {
                    firstNameInput.style.borderColor = 'var(--danger-color)';
                    firstNameInput.style.boxShadow = '0 0 0 3px rgba(245, 101, 101, 0.1)';
                    isValid = false;
                }

                if (!lastName || !validateName(lastName)) {
                    lastNameInput.style.borderColor = 'var(--danger-color)';
                    lastNameInput.style.boxShadow = '0 0 0 3px rgba(245, 101, 101, 0.1)';
                    isValid = false;
                }

                if (!email || !validateEmail(email)) {
                    emailInput.style.borderColor = 'var(--danger-color)';
                    emailInput.style.boxShadow = '0 0 0 3px rgba(245, 101, 101, 0.1)';
                    isValid = false;
                }

                if (!isValid) {
                    e.preventDefault();
                    alert('Please correct the errors in the form before submitting.');
                }
            });

            // Auto-save draft (localStorage)
            const formInputs = form.querySelectorAll('input[type="text"], input[type="email"], input[type="tel"]');
            const draftKey = 'user-form-draft';

            // Load draft
            const savedDraft = localStorage.getItem(draftKey);
            if (savedDraft) {
                const draft = JSON.parse(savedDraft);
                Object.keys(draft).forEach(key => {
                    const input = form.querySelector(`[name="${key}"]`);
                    if (input && !input.value) {
                        input.value = draft[key];
                    }
                });
            }

            // Save draft on input change
            formInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const formData = {};
                    formInputs.forEach(inp => {
                        if (inp.value) {
                            formData[inp.name] = inp.value;
                        }
                    });
                    localStorage.setItem(draftKey, JSON.stringify(formData));
                });
            });

            // Clear draft on successful submission
            form.addEventListener('submit', function() {
                localStorage.removeItem(draftKey);
            });
        });

        // Auto-hide alerts after 5 seconds
        setTimeout(function() {
            const alerts = document.querySelectorAll('.alert');
            alerts.forEach(function(alert) {
                alert.style.opacity = '0';
                alert.style.transform = 'translateY(-20px)';
                setTimeout(function() {
                    alert.remove();
                }, 300);
            });
        }, 5000);
    </script>
</body>
</html> 